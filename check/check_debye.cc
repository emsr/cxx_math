// { dg-do run { target c++11 } }
// { dg-options "-D__STDCPP_WANT_MATH_SPEC_FUNCS__" }
//
// Copyright (C) 2016-2017 Free Software Foundation, Inc.
//
// This file is part of the GNU ISO C++ Library.  This library is free
// software; you can redistribute it and/or modify it under the
// terms of the GNU General Public License as published by the
// Free Software Foundation; either version 3, or (at your option)
// any later version.
//
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this library; see the file COPYING3.  If not see
// <http://www.gnu.org/licenses/>.

//  debye
//  Compare against values generated by the GNU Scientific Library.
//  The GSL can be found on the web: http://www.gnu.org/software/gsl/
#include <limits>
#include <cmath>
#if defined(__TEST_DEBUG)
#  include <iostream>
#  define VERIFY(A) \
  if (!(A)) \
    { \
      std::cout << "line " << __LINE__ \
	<< "  max_abs_frac = " << max_abs_frac \
	<< std::endl; \
    }
#else
#  include <testsuite_hooks.h>
#endif
#include <specfun_testcase.h>


// Test data for n=1.
// max(|f - f_GSL|): 0.58974108038889661 at index 11
// max(|f - f_GSL| / |f_GSL|): 1.3491593992024280
// mean(f - f_GSL): 0.41518476696716011
// variance(f - f_GSL): 0.00054041979710632842
// stddev(f - f_GSL): 0.023246930918001379
const testcase_debye<double>
data001[41] =
{
  { 0.0000000000000000, 1, 0.0000000000000000, 0.0 },
  { 0.099954373840329624, 1, 0.25000000000000000, 0.0 },
  { 0.19422204216476238, 1, 0.50000000000000000, 0.0 },
  { 0.28286624893129669, 1, 0.75000000000000000, 0.0 },
  { 0.36599020706462387, 1, 1.0000000000000000, 0.0 },
  { 0.44373395947782968, 1, 1.2500000000000000, 0.0 },
  { 0.51627027032257544, 1, 1.5000000000000000, 0.0 },
  { 0.58379979496116330, 1, 1.7500000000000000, 0.0 },
  { 0.64654580161252406, 1, 2.0000000000000000, 0.0 },
  { 0.70474871740796841, 1, 2.2500000000000000, 0.0 },
  { 0.75866074980958598, 1, 2.5000000000000000, 0.0 },
  { 0.80854079629672049, 1, 2.7500000000000000, 0.0 },
  { 0.85464980725882100, 1, 3.0000000000000000, 0.0 },
  { 0.89724671543271406, 1, 3.2500000000000000, 0.0 },
  { 0.93658499536914486, 1, 3.5000000000000000, 0.0 },
  { 0.97290987228167303, 1, 3.7500000000000000, 0.0 },
  { 1.0064561636355183, 1, 4.0000000000000000, 0.0 },
  { 1.0374467099494682, 1, 4.2500000000000000, 0.0 },
  { 1.0660913333345139, 1, 4.5000000000000000, 0.0 },
  { 1.0925862523101260, 1, 4.7500000000000000, 0.0 },
  { 1.1171138780105301, 1, 5.0000000000000000, 0.0 },
  { 1.1398429184519179, 1, 5.2500000000000000, 0.0 },
  { 1.1609287225656912, 1, 5.5000000000000000, 0.0 },
  { 1.1805138028869135, 1, 5.7500000000000000, 0.0 },
  { 1.1987284840443928, 1, 6.0000000000000000, 0.0 },
  { 1.2156916327149312, 1, 6.2500000000000000, 0.0 },
  { 1.2315114329080188, 1, 6.5000000000000000, 0.0 },
  { 1.2462861779744554, 1, 6.7500000000000000, 0.0 },
  { 1.2601050573826558, 1, 7.0000000000000000, 0.0 },
  { 1.2730489220014409, 1, 7.2500000000000000, 0.0 },
  { 1.2851910163742621, 1, 7.5000000000000000, 0.0 },
  { 1.2965976703277848, 1, 7.7500000000000000, 0.0 },
  { 1.3073289453192050, 1, 8.0000000000000000, 0.0 },
  { 1.3174392332969898, 1, 8.2500000000000000, 0.0 },
  { 1.3269778076365599, 1, 8.5000000000000000, 0.0 },
  { 1.3359893270180432, 1, 8.7500000000000000, 0.0 },
  { 1.3445142940303951, 1, 9.0000000000000000, 0.0 },
  { 1.3525894708960182, 1, 9.2500000000000000, 0.0 },
  { 1.3602482550816510, 1, 9.5000000000000000, 0.0 },
  { 1.3675210177521455, 1, 9.7500000000000000, 0.0 },
  { 1.3744354080806969, 1, 10.000000000000000, 0.0 },
};
const double toler001 = 0.050000000000000003;

// Test data for n=2.
// max(|f - f_GSL|): 0.34835415205222819 at index 4
// max(|f - f_GSL| / |f_GSL|): 0.85198782537029383
// mean(f - f_GSL): 0.027708541721307538
// variance(f - f_GSL): 0.00017268710833472437
// stddev(f - f_GSL): 0.013141046698597657
const testcase_debye<double>
data002[41] =
{
  { 0.0000000000000000, 2, 0.0000000000000000, 0.0 },
  { 0.19408644702705763, 2, 0.25000000000000000, 0.0 },
  { 0.37571203670895476, 2, 0.50000000000000000, 0.0 },
  { 0.54503070130985642, 2, 0.75000000000000000, 0.0 },
  { 0.70229338986614287, 2, 1.0000000000000000, 0.0 },
  { 0.84784005919191552, 2, 1.2500000000000000, 0.0 },
  { 0.98208921138911121, 2, 1.5000000000000000, 0.0 },
  { 1.1055256282054036, 2, 1.7500000000000000, 0.0 },
  { 1.2186870142451818, 2, 2.0000000000000000, 0.0 },
  { 1.3221502572368018, 2, 2.2500000000000000, 0.0 },
  { 1.4165179528934677, 2, 2.5000000000000000, 0.0 },
  { 1.5024057388050527, 2, 2.7500000000000000, 0.0 },
  { 1.5804308533841254, 2, 3.0000000000000000, 0.0 },
  { 1.6512021989949057, 2, 3.2500000000000000, 0.0 },
  { 1.7153120572930325, 2, 3.5000000000000000, 0.0 },
  { 1.7733294898997471, 2, 3.7500000000000000, 0.0 },
  { 1.8257953649882901, 2, 4.0000000000000000, 0.0 },
  { 1.8732188824601039, 2, 4.2500000000000000, 0.0 },
  { 1.9160754263634652, 2, 4.5000000000000000, 0.0 },
  { 1.9548055502181698, 2, 4.7500000000000000, 0.0 },
  { 1.9898148949979699, 2, 5.0000000000000000, 0.0 },
  { 2.0214748463871648, 2, 5.2500000000000000, 0.0 },
  { 2.0501237534830676, 2, 5.5000000000000000, 0.0 },
  { 2.0760685518268995, 2, 5.7500000000000000, 0.0 },
  { 2.0995866566818195, 2, 6.0000000000000000, 0.0 },
  { 2.1209280157338442, 2, 6.2500000000000000, 0.0 },
  { 2.1403172324271531, 2, 6.5000000000000000, 0.0 },
  { 2.1579556910723170, 2, 6.7500000000000000, 0.0 },
  { 2.1740236322301656, 2, 7.0000000000000000, 0.0 },
  { 2.1886821415376478, 2, 7.2500000000000000, 0.0 },
  { 2.2020750271823371, 2, 7.5000000000000000, 0.0 },
  { 2.2143305708597869, 2, 7.7500000000000000, 0.0 },
  { 2.2255631445442625, 2, 8.0000000000000000, 0.0 },
  { 2.2358746910769050, 2, 8.2500000000000000, 0.0 },
  { 2.2453560707317242, 2, 8.5000000000000000, 0.0 },
  { 2.2540882788432985, 2, 8.7500000000000000, 0.0 },
  { 2.2621435415242641, 2, 9.0000000000000000, 0.0 },
  { 2.2695862976839680, 2, 9.2500000000000000, 0.0 },
  { 2.2764740761653841, 2, 9.5000000000000000, 0.0 },
  { 2.2828582769958543, 2, 9.7500000000000000, 0.0 },
  { 2.2887848656192000, 2, 10.000000000000000, 0.0 },
};
const double toler002 = 0.050000000000000003;

// Test data for n=3.
// max(|f - f_GSL|): 2.4529352286581849 at index 8
// max(|f - f_GSL| / |f_GSL|): 0.99195227195546831
// mean(f - f_GSL): -0.91628805689428283
// variance(f - f_GSL): 0.025310201250799785
// stddev(f - f_GSL): 0.15909180133118045
const testcase_debye<double>
data003[41] =
{
  { 0.0000000000000000, 3, 0.0000000000000000, 0.0 },
  { 0.58852834025208500, 3, 0.25000000000000000, 0.0 },
  { 1.1366798726210374, 3, 0.50000000000000000, 0.0 },
  { 1.6449888653569962, 3, 0.75000000000000000, 0.0 },
  { 2.1143255971998989, 3, 1.0000000000000000, 0.0 },
  { 2.5458675696447814, 3, 1.2500000000000000, 0.0 },
  { 2.9410619614145759, 3, 1.5000000000000000, 0.0 },
  { 3.3015817101580645, 3, 1.7500000000000000, 0.0 },
  { 3.6292778252651825, 3, 2.0000000000000000, 0.0 },
  { 3.9261305118127625, 3, 2.2500000000000000, 0.0 },
  { 4.1942014520488797, 3, 2.5000000000000000, 0.0 },
  { 4.4355892021476953, 3, 2.7500000000000000, 0.0 },
  { 4.6523891825982018, 3, 3.0000000000000000, 0.0 },
  { 4.8466592334097927, 3, 3.2500000000000000, 0.0 },
  { 5.0203912232152490, 3, 3.5000000000000000, 0.0 },
  { 5.1754887824130185, 3, 3.7500000000000000, 0.0 },
  { 5.3137508967532359, 3, 4.0000000000000000, 0.0 },
  { 5.4368608567508119, 3, 4.2500000000000000, 0.0 },
  { 5.5463799061820716, 3, 4.5000000000000000, 0.0 },
  { 5.6437448583208631, 3, 4.7500000000000000, 0.0 },
  { 5.7302689361746397, 3, 5.0000000000000000, 0.0 },
  { 5.8071451264297895, 3, 5.2500000000000000, 0.0 },
  { 5.8754514007593857, 3, 5.5000000000000000, 0.0 },
  { 5.9361572394606350, 3, 5.7500000000000000, 0.0 },
  { 5.9901309806981873, 3, 6.0000000000000000, 0.0 },
  { 6.0381476063361639, 3, 6.2500000000000000, 0.0 },
  { 6.0808966573498138, 3, 6.5000000000000000, 0.0 },
  { 6.1189900450889922, 3, 6.7500000000000000, 0.0 },
  { 6.1529695877856030, 3, 7.0000000000000000, 0.0 },
  { 6.1833141543661743, 3, 7.2500000000000000, 0.0 },
  { 6.2104463403212975, 3, 7.5000000000000000, 0.0 },
  { 6.2347386340240725, 3, 7.7500000000000000, 0.0 },
  { 6.2565190576361429, 3, 8.0000000000000000, 0.0 },
  { 6.2760762858159751, 3, 8.2500000000000000, 0.0 },
  { 6.2936642590356318, 3, 8.5000000000000000, 0.0 },
  { 6.3095063175054289, 3, 8.7500000000000000, 0.0 },
  { 6.3237988874546849, 3, 9.0000000000000000, 0.0 },
  { 6.3367147546336868, 3, 9.2500000000000000, 0.0 },
  { 6.3484059610599752, 3, 9.5000000000000000, 0.0 },
  { 6.3590063607765970, 3, 9.7500000000000000, 0.0 },
  { 6.3686338691533857, 3, 10.000000000000000, 0.0 },
};
const double toler003 = 0.050000000000000003;

// Test data for n=4.
// max(|f - f_GSL|): 13.704344334088292 at index 11
// max(|f - f_GSL| / |f_GSL|): 0.99963272674313886
// mean(f - f_GSL): -6.5651490696612376
// variance(f - f_GSL): inf
// stddev(f - f_GSL): inf
const testcase_debye<double>
data004[41] =
{
  { 0.0000000000000000, 4, 0.0000000000000000, 0.0 },
  { 2.4022833941369868, 4, 0.25000000000000000, 0.0 },
  { 4.6326856558726606, 4, 0.50000000000000000, 0.0 },
  { 6.6935942851247843, 4, 0.75000000000000000, 0.0 },
  { 8.5888957677849866, 4, 1.0000000000000000, 0.0 },
  { 10.323843409012550, 4, 1.2500000000000000, 0.0 },
  { 11.904885192000533, 4, 1.5000000000000000, 0.0 },
  { 13.339462791420903, 4, 1.7500000000000000, 0.0 },
  { 14.635793863167217, 4, 2.0000000000000000, 0.0 },
  { 15.802649581232110, 4, 2.2500000000000000, 0.0 },
  { 16.849138258780485, 4, 2.5000000000000000, 0.0 },
  { 17.784504035757703, 4, 2.7500000000000000, 0.0 },
  { 18.617947346463524, 4, 3.0000000000000000, 0.0 },
  { 19.358471495296861, 4, 3.2500000000000000, 0.0 },
  { 20.014757416094326, 4, 3.5000000000000000, 0.0 },
  { 20.595066747355673, 4, 3.7500000000000000, 0.0 },
  { 21.107171822535747, 4, 4.0000000000000000, 0.0 },
  { 21.558310082880897, 4, 4.2500000000000000, 0.0 },
  { 21.955159748077229, 4, 4.5000000000000000, 0.0 },
  { 22.303833270374160, 4, 4.7500000000000000, 0.0 },
  { 22.609885076204833, 4, 5.0000000000000000, 0.0 },
  { 22.878330287057594, 4, 5.2500000000000000, 0.0 },
  { 23.113671435524100, 4, 5.5000000000000000, 0.0 },
  { 23.319930591330184, 4, 5.7500000000000000, 0.0 },
  { 23.500684737489717, 4, 6.0000000000000000, 0.0 },
  { 23.659102653667535, 4, 6.2500000000000000, 0.0 },
  { 23.797981949477123, 4, 6.5000000000000000, 0.0 },
  { 23.919785231612327, 4, 6.7500000000000000, 0.0 },
  { 24.026674679683691, 4, 7.0000000000000000, 0.0 },
  { 24.120544545923362, 4, 7.2500000000000000, 0.0 },
  { 24.203051286489313, 4, 7.5000000000000000, 0.0 },
  { 24.275641181877688, 4, 7.7500000000000000, 0.0 },
  { 24.339575416801029, 4, 8.0000000000000000, 0.0 },
  { 24.395952671856168, 4, 8.2500000000000000, 0.0 },
  { 24.445729336149881, 4, 8.5000000000000000, 0.0 },
  { 24.489737486978360, 4, 8.7500000000000000, 0.0 },
  { 24.528700804190027, 4, 9.0000000000000000, 0.0 },
  { 24.563248596807750, 4, 9.2500000000000000, 0.0 },
  { 24.593928120968840, 4, 9.5000000000000000, 0.0 },
  { 24.621215363761529, 4, 9.7500000000000000, 0.0 },
  { 24.645524459056144, 4, 10.000000000000000, 0.0 },
};
const double toler004 = 0.050000000000000003;

// Test data for n=5.
// max(|f - f_GSL|): 82.584425049718703 at index 13
// max(|f - f_GSL| / |f_GSL|): 0.99998567286251305
// mean(f - f_GSL): -45.291913693742842
// variance(f - f_GSL): inf
// stddev(f - f_GSL): inf
const testcase_debye<double>
data005[41] =
{
  { 0.0000000000000000, 5, 0.0000000000000000, 0.0 },
  { 12.262984780199877, 5, 0.25000000000000000, 0.0 },
  { 23.622751390728038, 5, 0.50000000000000000, 0.0 },
  { 34.092307950848713, 5, 0.75000000000000000, 0.0 },
  { 43.692818326508124, 5, 1.0000000000000000, 0.0 },
  { 52.452866395933988, 5, 1.2500000000000000, 0.0 },
  { 60.407498883960933, 5, 1.5000000000000000, 0.0 },
  { 67.597109555123637, 5, 1.7500000000000000, 0.0 },
  { 74.066233013773768, 5, 2.0000000000000000, 0.0 },
  { 79.862315318049113, 5, 2.2500000000000000, 0.0 },
  { 85.034522007548446, 5, 2.5000000000000000, 0.0 },
  { 89.632633485081683, 5, 2.7500000000000000, 0.0 },
  { 93.706064742424317, 5, 3.0000000000000000, 0.0 },
  { 97.303032880332239, 5, 3.2500000000000000, 0.0 },
  { 100.46988315629987, 5, 3.5000000000000000, 0.0 },
  { 103.25057339591258, 5, 3.7500000000000000, 0.0 },
  { 105.68630807835130, 5, 4.0000000000000000, 0.0 },
  { 107.81530741210595, 5, 4.2500000000000000, 0.0 },
  { 109.67269310923601, 5, 4.5000000000000000, 0.0 },
  { 111.29047100587569, 5, 4.7500000000000000, 0.0 },
  { 112.69759072690476, 5, 5.0000000000000000, 0.0 },
  { 113.92006379998635, 5, 5.2500000000000000, 0.0 },
  { 114.98112357126624, 5, 5.5000000000000000, 0.0 },
  { 115.90141261196126, 5, 5.7500000000000000, 0.0 },
  { 116.69918576099256, 5, 6.0000000000000000, 0.0 },
  { 117.39051933062868, 5, 6.2500000000000000, 0.0 },
  { 117.98951918510136, 5, 6.5000000000000000, 0.0 },
  { 118.50852231706031, 5, 6.7500000000000000, 0.0 },
  { 118.95828816598211, 5, 7.0000000000000000, 0.0 },
  { 119.34817724784178, 5, 7.2500000000000000, 0.0 },
  { 119.68631571673340, 5, 7.5000000000000000, 0.0 },
  { 119.97974528739169, 5, 7.7500000000000000, 0.0 },
  { 120.23455854790335, 5, 8.0000000000000000, 0.0 },
  { 120.45602011990712, 5, 8.2500000000000000, 0.0 },
  { 120.64867441272426, 5, 8.5000000000000000, 0.0 },
  { 120.81644089803427, 5, 8.7500000000000000, 0.0 },
  { 120.96269792863676, 5, 9.0000000000000000, 0.0 },
  { 121.09035615997526, 5, 9.2500000000000000, 0.0 },
  { 121.20192262388238, 5, 9.5000000000000000, 0.0 },
  { 121.29955646427398, 5, 9.7500000000000000, 0.0 },
  { 121.38511728501015, 5, 10.000000000000000, 0.0 },
};
const double toler005 = 0.050000000000000003;

// Test data for n=6.
// max(|f - f_GSL|): 556.66687083564750 at index 15
// max(|f - f_GSL| / |f_GSL|): 0.99999951317349978
// mean(f - f_GSL): -338.53940275193236
// variance(f - f_GSL): inf
// stddev(f - f_GSL): inf
const testcase_debye<double>
data006[41] =
{
  { 0.0000000000000000, 6, 0.0000000000000000, 0.0 },
  { 74.953322304375973, 6, 0.25000000000000000, 0.0 },
  { 144.26758567203200, 6, 0.50000000000000000, 0.0 },
  { 208.02630944386186, 6, 0.75000000000000000, 0.0 },
  { 266.36531662008804, 6, 1.0000000000000000, 0.0 },
  { 319.46792670229252, 6, 1.2500000000000000, 0.0 },
  { 367.55870786407235, 6, 1.5000000000000000, 0.0 },
  { 410.89620335609806, 6, 1.7500000000000000, 0.0 },
  { 449.76508230657629, 6, 2.0000000000000000, 0.0 },
  { 484.46815710258267, 6, 2.2500000000000000, 0.0 },
  { 515.31866468158728, 6, 2.5000000000000000, 0.0 },
  { 542.63313752463353, 6, 2.7500000000000000, 0.0 },
  { 566.72510374042179, 6, 3.0000000000000000, 0.0 },
  { 587.89976572679063, 6, 3.2500000000000000, 0.0 },
  { 606.44972286895495, 6, 3.5000000000000000, 0.0 },
  { 622.65173213942160, 6, 3.7500000000000000, 0.0 },
  { 636.76444487789229, 6, 4.0000000000000000, 0.0 },
  { 649.02701938626490, 6, 4.2500000000000000, 0.0 },
  { 659.65848620341774, 6, 4.5000000000000000, 0.0 },
  { 668.85773367395666, 6, 4.7500000000000000, 0.0 },
  { 676.80398272688308, 6, 5.0000000000000000, 0.0 },
  { 683.65762857831942, 6, 5.2500000000000000, 0.0 },
  { 689.56134058021360, 6, 5.5000000000000000, 0.0 },
  { 694.64132733545648, 6, 5.7500000000000000, 0.0 },
  { 699.00869071058423, 6, 6.0000000000000000, 0.0 },
  { 702.76080824664302, 6, 6.2500000000000000, 0.0 },
  { 705.98269790120719, 6, 6.5000000000000000, 0.0 },
  { 708.74833162187565, 6, 6.7500000000000000, 0.0 },
  { 711.12187479982765, 6, 7.0000000000000000, 0.0 },
  { 713.15883721637692, 6, 7.2500000000000000, 0.0 },
  { 714.90712782994012, 6, 7.5000000000000000, 0.0 },
  { 716.40801087401451, 6, 7.7500000000000000, 0.0 },
  { 717.69696449261005, 6, 8.0000000000000000, 0.0 },
  { 718.80444577108562, 6, 8.2500000000000000, 0.0 },
  { 719.75656775331868, 6, 8.5000000000000000, 0.0 },
  { 720.57569507047333, 6, 8.7500000000000000, 0.0 },
  { 721.28096531286644, 6, 9.0000000000000000, 0.0 },
  { 721.88874339568326, 6, 9.2500000000000000, 0.0 },
  { 722.41301601532371, 6, 9.5000000000000000, 0.0 },
  { 722.86573295548544, 6, 9.7500000000000000, 0.0 },
  { 723.25710154948638, 6, 10.000000000000000, 0.0 },
};
const double toler006 = 0.050000000000000003;

template<typename Ret, unsigned int Num>
  void
  test(const testcase_debye<Ret> (&data)[Num], Ret toler)
  {
    bool test __attribute__((unused)) = true;
    const Ret eps = std::numeric_limits<Ret>::epsilon();
    Ret max_abs_diff = -Ret(1);
    Ret max_abs_frac = -Ret(1);
    unsigned int num_datum = Num;
    for (unsigned int i = 0; i < num_datum; ++i)
      {
	const Ret f = __gnu_cxx::debye(data[i].n, data[i].x);
	const Ret f0 = data[i].f0;
	const Ret diff = f - f0;
	if (std::abs(diff) > max_abs_diff)
	  max_abs_diff = std::abs(diff);
	if (std::abs(f0) > Ret(10) * eps
	 && std::abs(f) > Ret(10) * eps)
	  {
	    const Ret frac = diff / f0;
	    if (std::abs(frac) > max_abs_frac)
	      max_abs_frac = std::abs(frac);
	  }
      }
    VERIFY(max_abs_frac < toler);
  }

int
main()
{
  test(data001, toler001);
  test(data002, toler002);
  test(data003, toler003);
  test(data004, toler004);
  test(data005, toler005);
  test(data006, toler006);
  return 0;
}
