// { dg-do compile { target c++11 } }
// { dg-options "-D__STDCPP_WANT_MATH_SPEC_FUNCS__" }
//
// Copyright (C) 2016 Free Software Foundation, Inc.
//
// This file is part of the GNU ISO C++ Library.  This library is free
// software; you can redistribute it and/or modify it under the
// terms of the GNU General Public License as published by the
// Free Software Foundation; either version 3, or (at your option)
// any later version.
//
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this library; see the file COPYING3.  If not see
// <http://www.gnu.org/licenses/>.

//  lfactorial

//  Compare against values generated by the GNU Scientific Library.
//  The GSL can be found on the web: http://www.gnu.org/software/gsl/
#include <limits>
#include <cmath>
#if defined(__TEST_DEBUG)
#  include <iostream>
#  define VERIFY(A) \
  if (!(A)) \
    { \
      std::cout << "line " << __LINE__ \
	<< "  max_abs_frac = " << max_abs_frac \
	<< std::endl; \
    }
#else
#  include <testsuite_hooks.h>
#endif
#include <specfun_testcase.h>

// Test data.
// max(|f - f_GSL|): 711.71472580228999
// max(|f - f_GSL| / |f_GSL|): 4.3241251717587865e-16
// mean(f - f_GSL): -1.4205882750543883
// variance(f - f_GSL): inf
// stddev(f - f_GSL): inf
const testcase_lfactorial<double>
data001[501] =
{
  { 0.0000000000000000, 0 },
  { 0.0000000000000000, 1 },
  { 0.69314718055994529, 2 },
  { 1.7917594692280550, 3 },
  { 3.1780538303479458, 4 },
  { 4.7874917427820458, 5 },
  { 6.5792512120101012, 6 },
  { 8.5251613610654147, 7 },
  { 10.604602902745251, 8 },
  { 12.801827480081469, 9 },
  { 15.104412573075516, 10 },
  { 17.502307845873887, 11 },
  { 19.987214495661885, 12 },
  { 22.552163853123425, 13 },
  { 25.191221182738680, 14 },
  { 27.899271383840890, 15 },
  { 30.671860106080672, 16 },
  { 33.505073450136891, 17 },
  { 36.395445208033053, 18 },
  { 39.339884187199495, 19 },
  { 42.335616460753485, 20 },
  { 45.380138898476908, 21 },
  { 48.471181351835227, 22 },
  { 51.606675567764377, 23 },
  { 54.784729398112319, 24 },
  { 58.003605222980518, 25 },
  { 61.261701761002001, 26 },
  { 64.557538627006338, 27 },
  { 67.889743137181540, 28 },
  { 71.257038967168015, 29 },
  { 74.658236348830158, 30 },
  { 78.092223553315307, 31 },
  { 81.557959456115043, 32 },
  { 85.054467017581516, 33 },
  { 88.580827542197682, 34 },
  { 92.136175603687093, 35 },
  { 95.719694542143202, 36 },
  { 99.330612454787428, 37 },
  { 102.96819861451381, 38 },
  { 106.63176026064346, 39 },
  { 110.32063971475739, 40 },
  { 114.03421178146171, 41 },
  { 117.77188139974507, 42 },
  { 121.53308151543864, 43 },
  { 125.31727114935690, 44 },
  { 129.12393363912722, 45 },
  { 132.95257503561632, 46 },
  { 136.80272263732635, 47 },
  { 140.67392364823425, 48 },
  { 144.56574394634490, 49 },
  { 148.47776695177302, 50 },
  { 152.40959258449735, 51 },
  { 156.36083630307880, 52 },
  { 160.33112821663090, 53 },
  { 164.32011226319517, 54 },
  { 168.32744544842765, 55 },
  { 172.35279713916279, 56 },
  { 176.39584840699735, 57 },
  { 180.45629141754378, 58 },
  { 184.53382886144948, 59 },
  { 188.62817342367160, 60 },
  { 192.73904728784490, 61 },
  { 196.86618167289001, 62 },
  { 201.00931639928152, 63 },
  { 205.16819948264120, 64 },
  { 209.34258675253685, 65 },
  { 213.53224149456327, 66 },
  { 217.73693411395422, 67 },
  { 221.95644181913033, 68 },
  { 226.19054832372760, 69 },
  { 230.43904356577696, 70 },
  { 234.70172344281826, 71 },
  { 238.97838956183432, 72 },
  { 243.26884900298271, 73 },
  { 247.57291409618688, 74 },
  { 251.89040220972319, 75 },
  { 256.22113555000954, 76 },
  { 260.56494097186322, 77 },
  { 264.92164979855278, 78 },
  { 269.29109765101981, 79 },
  { 273.67312428569369, 80 },
  { 278.06757344036612, 81 },
  { 282.47429268763040, 82 },
  { 286.89313329542699, 83 },
  { 291.32395009427029, 84 },
  { 295.76660135076065, 85 },
  { 300.22094864701415, 86 },
  { 304.68685676566872, 87 },
  { 309.16419358014690, 88 },
  { 313.65282994987905, 89 },
  { 318.15263962020930, 90 },
  { 322.66349912672615, 91 },
  { 327.18528770377520, 92 },
  { 331.71788719692847, 93 },
  { 336.26118197919845, 94 },
  { 340.81505887079902, 95 },
  { 345.37940706226686, 96 },
  { 349.95411804077025, 97 },
  { 354.53908551944079, 98 },
  { 359.13420536957540, 99 },
  { 363.73937555556347, 100 },
  { 368.35449607240474, 101 },
  { 372.97946888568902, 102 },
  { 377.61419787391867, 103 },
  { 382.25858877306001, 104 },
  { 386.91254912321756, 105 },
  { 391.57598821732961, 106 },
  { 396.24881705179155, 107 },
  { 400.93094827891576, 108 },
  { 405.62229616114490, 109 },
  { 410.32277652693733, 110 },
  { 415.03230672824964, 111 },
  { 419.75080559954472, 112 },
  { 424.47819341825709, 113 },
  { 429.21439186665157, 114 },
  { 433.95932399501481, 115 },
  { 438.71291418612117, 116 },
  { 443.47508812091894, 117 },
  { 448.24577274538461, 118 },
  { 453.02489623849613, 119 },
  { 457.81238798127816, 120 },
  { 462.60817852687489, 121 },
  { 467.41219957160820, 122 },
  { 472.22438392698058, 123 },
  { 477.04466549258564, 124 },
  { 481.87297922988796, 125 },
  { 486.70926113683942, 126 },
  { 491.55344822329801, 127 },
  { 496.40547848721764, 128 },
  { 501.26529089157930, 129 },
  { 506.13282534203489, 130 },
  { 511.00802266523601, 131 },
  { 515.89082458782241, 132 },
  { 520.78117371604412, 133 },
  { 525.67901351599505, 134 },
  { 530.58428829443346, 135 },
  { 535.49694318016952, 136 },
  { 540.41692410599762, 137 },
  { 545.34417779115483, 138 },
  { 550.27865172428551, 139 },
  { 555.22029414689484, 140 },
  { 560.16905403727299, 141 },
  { 565.12488109487435, 142 },
  { 570.08772572513419, 143 },
  { 575.05753902471020, 144 },
  { 580.03427276713080, 145 },
  { 585.01787938883911, 146 },
  { 590.00831197561786, 147 },
  { 595.00552424938201, 148 },
  { 600.00947055532743, 149 },
  { 605.02010584942366, 150 },
  { 610.03738568623862, 151 },
  { 615.06126620708494, 152 },
  { 620.09170412847732, 153 },
  { 625.12865673089095, 154 },
  { 630.17208184781020, 155 },
  { 635.22193785505976, 156 },
  { 640.27818366040799, 157 },
  { 645.34077869343503, 158 },
  { 650.40968289565524, 159 },
  { 655.48485671088906, 160 },
  { 660.56626107587351, 161 },
  { 665.65385741110595, 162 },
  { 670.74760761191271, 163 },
  { 675.84747403973688, 164 },
  { 680.95341951363741, 165 },
  { 686.06540730199401, 166 },
  { 691.18340111441080, 167 },
  { 696.30736509381404, 168 },
  { 701.43726380873704, 169 },
  { 706.57306224578736, 170 },
  { 711.71472580228999, 171 },
  { 716.86222027910344, 172 },
  { 722.01551187360121, 173 },
  { 727.17456717281561, 174 },
  { 732.33935314673920, 175 },
  { 737.50983714177744, 176 },
  { 742.68598687435122, 177 },
  { 747.86777042464314, 178 },
  { 753.05515623048404, 179 },
  { 758.24811308137419, 180 },
  { 763.44661011263997, 181 },
  { 768.65061679971689, 182 },
  { 773.86010295255824, 183 },
  { 779.07503871016718, 184 },
  { 784.29539453524569, 185 },
  { 789.52114120895885, 186 },
  { 794.75224982581335, 187 },
  { 799.98869178864322, 188 },
  { 805.23043880370290, 189 },
  { 810.47746287586335, 190 },
  { 815.72973630391004, 191 },
  { 820.98723167593789, 192 },
  { 826.24992186484269, 193 },
  { 831.51778002390608, 194 },
  { 836.79077958246990, 195 },
  { 842.06889424170038, 196 },
  { 847.35209797043831, 197 },
  { 852.64036500113298, 198 },
  { 857.93366982585746, 199 },
  { 863.23198719240543, 200 },
  { 868.53529210046452, 201 },
  { 873.84355979786551, 202 },
  { 879.15676577690749, 203 },
  { 884.47488577075171, 204 },
  { 889.79789574989013, 205 },
  { 895.12577191867967, 206 },
  { 900.45849071194505, 207 },
  { 905.79602879164645, 208 },
  { 911.13836304361109, 209 },
  { 916.48547057432859, 210 },
  { 921.83732870780455, 211 },
  { 927.19391498247660, 212 },
  { 932.55520714818613, 213 },
  { 937.92118316320796, 214 },
  { 943.29182119133554, 215 },
  { 948.66709959901982, 216 },
  { 954.04699695256022, 217 },
  { 959.43149201534936, 218 },
  { 964.82056374516583, 219 },
  { 970.21419129151809, 220 },
  { 975.61235399303598, 221 },
  { 981.01503137490829, 222 },
  { 986.42220314636825, 223 },
  { 991.83384919822333, 224 },
  { 997.24994960042795, 225 },
  { 1002.6704845997001, 226 },
  { 1008.0954346171814, 227 },
  { 1013.5247802461359, 228 },
  { 1018.9585022496900, 229 },
  { 1024.3965815586134, 230 },
  { 1029.8389992691352, 231 },
  { 1035.2857366408016, 232 },
  { 1040.7367750943670, 233 },
  { 1046.1920962097249, 234 },
  { 1051.6516817238689, 235 },
  { 1057.1155135288946, 236 },
  { 1062.5835736700296, 237 },
  { 1068.0558443437010, 238 },
  { 1073.5323078956328, 239 },
  { 1079.0129468189748, 240 },
  { 1084.4977437524653, 241 },
  { 1089.9866814786221, 242 },
  { 1095.4797429219625, 243 },
  { 1100.9769111472558, 244 },
  { 1106.4781693578007, 245 },
  { 1111.9835008937330, 246 },
  { 1117.4928892303608, 247 },
  { 1123.0063179765259, 248 },
  { 1128.5237708729906, 249 },
  { 1134.0452317908528, 250 },
  { 1139.5706847299846, 251 },
  { 1145.1001138174961, 252 },
  { 1150.6335033062235, 253 },
  { 1156.1708375732421, 254 },
  { 1161.7121011184006, 255 },
  { 1167.2572785628802, 256 },
  { 1172.8063546477754, 257 },
  { 1178.3593142326968, 258 },
  { 1183.9161422943966, 259 },
  { 1189.4768239254117, 260 },
  { 1195.0413443327348, 261 },
  { 1200.6096888364957, 262 },
  { 1206.1818428686736, 263 },
  { 1211.7577919718199, 264 },
  { 1217.3375217978059, 265 },
  { 1222.9210181065878, 266 },
  { 1228.5082667649881, 267 },
  { 1234.0992537454990, 268 },
  { 1239.6939651251007, 269 },
  { 1245.2923870840991, 270 },
  { 1250.8945059049788, 271 },
  { 1256.5003079712749, 272 },
  { 1262.1097797664600, 273 },
  { 1267.7229078728478, 274 },
  { 1273.3396789705146, 275 },
  { 1278.9600798362317, 276 },
  { 1284.5840973424188, 277 },
  { 1290.2117184561096, 278 },
  { 1295.8429302379311, 279 },
  { 1301.4777198411002, 280 },
  { 1307.1160745104339, 281 },
  { 1312.7579815813720, 282 },
  { 1318.4034284790155, 283 },
  { 1324.0524027171764, 284 },
  { 1329.7048918974451, 285 },
  { 1335.3608837082650, 286 },
  { 1341.0203659240246, 287 },
  { 1346.6833264041604, 288 },
  { 1352.3497530922732, 289 },
  { 1358.0196340152536, 290 },
  { 1363.6929572824249, 291 },
  { 1369.3697110846933, 292 },
  { 1375.0498836937104, 293 },
  { 1380.7334634610490, 294 },
  { 1386.4204388173889, 295 },
  { 1392.1107982717131, 296 },
  { 1397.8045304105156, 297 },
  { 1403.5016238970211, 298 },
  { 1409.2020674704117, 299 },
  { 1414.9058499450680, 300 },
  { 1420.6129602098169, 301 },
  { 1426.3233872271917, 302 },
  { 1432.0371200327011, 303 },
  { 1437.7541477341072, 304 },
  { 1443.4744595107147, 305 },
  { 1449.1980446126670, 306 },
  { 1454.9248923602543, 307 },
  { 1460.6549921432279, 308 },
  { 1466.3883334201255, 309 },
  { 1472.1249057176046, 310 },
  { 1477.8646986297840, 311 },
  { 1483.6077018175934, 312 },
  { 1489.3539050081336, 313 },
  { 1495.1032979940417, 314 },
  { 1500.8558706328674, 315 },
  { 1506.6116128464546, 316 },
  { 1512.3705146203317, 317 },
  { 1518.1325660031118, 318 },
  { 1523.8977571058965, 319 },
  { 1529.6660781016901, 320 },
  { 1535.4375192248206, 321 },
  { 1541.2120707703648, 322 },
  { 1546.9897230935876, 323 },
  { 1552.7704666093798, 324 },
  { 1558.5542917917096, 325 },
  { 1564.3411891730764, 326 },
  { 1570.1311493439737, 327 },
  { 1575.9241629523576, 328 },
  { 1581.7202207031230, 329 },
  { 1587.5193133575835, 330 },
  { 1593.3214317329605, 331 },
  { 1599.1265667018770, 332 },
  { 1604.9347091918576, 333 },
  { 1610.7458501848344, 334 },
  { 1616.5599807166593, 335 },
  { 1622.3770918766224, 336 },
  { 1628.1971748069750, 337 },
  { 1634.0202207024579, 338 },
  { 1639.8462208098383, 339 },
  { 1645.6751664274484, 340 },
  { 1651.5070489047321, 341 },
  { 1657.3418596417948, 342 },
  { 1663.1795900889606, 343 },
  { 1669.0202317463340, 344 },
  { 1674.8637761633654, 345 },
  { 1680.7102149384232, 346 },
  { 1686.5595397183699, 347 },
  { 1692.4117421981443, 348 },
  { 1698.2668141203469, 349 },
  { 1704.1247472748303, 350 },
  { 1709.9855334982960, 351 },
  { 1715.8491646738944, 352 },
  { 1721.7156327308276, 353 },
  { 1727.5849296439615, 354 },
  { 1733.4570474334369, 355 },
  { 1739.3319781642888, 356 },
  { 1745.2097139460684, 357 },
  { 1751.0902469324692, 358 },
  { 1756.9735693209575, 359 },
  { 1762.8596733524075, 360 },
  { 1768.7485513107404, 361 },
  { 1774.6401955225665, 362 },
  { 1780.5345983568311, 363 },
  { 1786.4317522244678, 364 },
  { 1792.3316495780502, 365 },
  { 1798.2342829114518, 366 },
  { 1804.1396447595062, 367 },
  { 1810.0477276976751, 368 },
  { 1815.9585243417157, 369 },
  { 1821.8720273473541, 370 },
  { 1827.7882294099613, 371 },
  { 1833.7071232642345, 372 },
  { 1839.6287016838785, 373 },
  { 1845.5529574812929, 374 },
  { 1851.4798835072631, 375 },
  { 1857.4094726506532, 376 },
  { 1863.3417178381014, 377 },
  { 1869.2766120337210, 378 },
  { 1875.2141482388033, 379 },
  { 1881.1543194915239, 380 },
  { 1887.0971188666504, 381 },
  { 1893.0425394752569, 382 },
  { 1898.9905744644377, 383 },
  { 1904.9412170170253, 384 },
  { 1910.8944603513130, 385 },
  { 1916.8502977207779, 386 },
  { 1922.8087224138080, 387 },
  { 1928.7697277534312, 388 },
  { 1934.7333070970494, 389 },
  { 1940.6994538361732, 390 },
  { 1946.6681613961587, 391 },
  { 1952.6394232359489, 392 },
  { 1958.6132328478184, 393 },
  { 1964.5895837571161, 394 },
  { 1970.5684695220175, 395 },
  { 1976.5498837332718, 396 },
  { 1982.5338200139593, 397 },
  { 1988.5202720192433, 398 },
  { 1994.5092334361334, 399 },
  { 2000.5006979832413, 400 },
  { 2006.4946594105479, 401 },
  { 2012.4911114991669, 402 },
  { 2018.4900480611138, 403 },
  { 2024.4914629390746, 404 },
  { 2030.4953500061811, 405 },
  { 2036.5017031657828, 406 },
  { 2042.5105163512255, 407 },
  { 2048.5217835256299, 408 },
  { 2054.5354986816728, 409 },
  { 2060.5516558413710, 410 },
  { 2066.5702490558670, 411 },
  { 2072.5912724052168, 412 },
  { 2078.6147199981774, 413 },
  { 2084.6405859720026, 414 },
  { 2090.6688644922338, 415 },
  { 2096.6995497524949, 416 },
  { 2102.7326359742942, 417 },
  { 2108.7681174068189, 418 },
  { 2114.8059883267406, 419 },
  { 2120.8462430380182, 420 },
  { 2126.8888758717003, 421 },
  { 2132.9338811857369, 422 },
  { 2138.9812533647823, 423 },
  { 2145.0309868200143, 424 },
  { 2151.0830759889391, 425 },
  { 2157.1375153352083, 426 },
  { 2163.1942993484372, 427 },
  { 2169.2534225440190, 428 },
  { 2175.3148794629469, 429 },
  { 2181.3786646716344, 430 },
  { 2187.4447727617380, 431 },
  { 2193.5131983499823, 432 },
  { 2199.5839360779851, 433 },
  { 2205.6569806120856, 434 },
  { 2211.7323266431736, 435 },
  { 2217.8099688865227, 436 },
  { 2223.8899020816184, 437 },
  { 2229.9721209919949, 438 },
  { 2236.0566204050701, 439 },
  { 2242.1433951319827, 440 },
  { 2248.2324400074294, 441 },
  { 2254.3237498895073, 442 },
  { 2260.4173196595520, 443 },
  { 2266.5131442219845, 444 },
  { 2272.6112185041511, 445 },
  { 2278.7115374561708, 446 },
  { 2284.8140960507844, 447 },
  { 2290.9188892831990, 448 },
  { 2297.0259121709414, 449 },
  { 2303.1351597537055, 450 },
  { 2309.2466270932082, 451 },
  { 2315.3603092730405, 452 },
  { 2321.4762013985237, 453 },
  { 2327.5942985965653, 454 },
  { 2333.7145960155158, 455 },
  { 2339.8370888250302, 456 },
  { 2345.9617722159251, 457 },
  { 2352.0886414000388, 458 },
  { 2358.2176916100993, 459 },
  { 2364.3489180995825, 460 },
  { 2370.4823161425788, 461 },
  { 2376.6178810336610, 462 },
  { 2382.7556080877475, 463 },
  { 2388.8954926399733, 464 },
  { 2395.0375300455607, 465 },
  { 2401.1817156796865, 466 },
  { 2407.3280449373551, 467 },
  { 2413.4765132332727, 468 },
  { 2419.6271160017195, 469 },
  { 2425.7798486964234, 470 },
  { 2431.9347067904396, 471 },
  { 2438.0916857760253, 472 },
  { 2444.2507811645173, 473 },
  { 2450.4119884862121, 474 },
  { 2456.5753032902467, 475 },
  { 2462.7407211444784, 476 },
  { 2468.9082376353667, 477 },
  { 2475.0778483678582, 478 },
  { 2481.2495489652692, 479 },
  { 2487.4233350691711, 480 },
  { 2493.5992023392769, 481 },
  { 2499.7771464533271, 482 },
  { 2505.9571631069803, 483 },
  { 2512.1392480136965, 484 },
  { 2518.3233969046337, 485 },
  { 2524.5096055285348, 486 },
  { 2530.6978696516176, 487 },
  { 2536.8881850574708, 488 },
  { 2543.0805475469456, 489 },
  { 2549.2749529380499, 490 },
  { 2555.4713970658445, 491 },
  { 2561.6698757823369, 492 },
  { 2567.8703849563790, 493 },
  { 2574.0729204735676, 494 },
  { 2580.2774782361362, 495 },
  { 2586.4840541628614, 496 },
  { 2592.6926441889577, 497 },
  { 2598.9032442659823, 498 },
  { 2605.1158503617335, 499 },
  { 2611.3304584601556, 500 },
};
const double toler001 = 2.5000000000000020e-13;

template<typename Ret, unsigned int Num>
  void
  test(const testcase_lfactorial<Ret> (&data)[Num], Ret toler)
  {
    bool test __attribute__((unused)) = true;
    const Ret eps = std::numeric_limits<Ret>::epsilon();
    Ret max_abs_diff = -Ret(1);
    Ret max_abs_frac = -Ret(1);
    unsigned int num_datum = Num;
    for (unsigned int i = 0; i < num_datum; ++i)
      {
	const Ret f = __gnu_cxx::lfactorial<Ret>(data[i].n);
	const Ret f0 = data[i].f0;
	const Ret diff = f - f0;
	if (std::abs(diff) > max_abs_diff)
	  max_abs_diff = std::abs(diff);
	if (std::abs(f0) > Ret(10) * eps
	 && std::abs(f) > Ret(10) * eps)
	  {
	    const Ret frac = diff / f0;
	    if (std::abs(frac) > max_abs_frac)
	      max_abs_frac = std::abs(frac);
	  }
      }
    VERIFY(max_abs_frac < toler);
  }

int
main()
{
  test(data001, toler001);
  return 0;
}
