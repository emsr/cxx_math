// { dg-options "-D__STDCPP_WANT_MATH_SPEC_FUNCS__" }
//
// Copyright (C) 2016 Free Software Foundation, Inc.
//
// This file is part of the GNU ISO C++ Library.  This library is free
// software; you can redistribute it and/or modify it under the
// terms of the GNU General Public License as published by the
// Free Software Foundation; either version 3, or (at your option)
// any later version.
//
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this library; see the file COPYING3.  If not see
// <http://www.gnu.org/licenses/>.

//  pochhammer_l
//  Compare against values generated by the GNU Scientific Library.
//  The GSL can be found on the web: http://www.gnu.org/software/gsl/
#include <limits>
#include <cmath>
#if defined(__TEST_DEBUG)
#  include <iostream>
#  define VERIFY(A) \
  if (!(A)) \
    { \
      std::cout << "line " << __LINE__ \
	<< "  max_abs_frac = " << max_abs_frac \
	<< std::endl; \
    }
#else
#  include <testsuite_hooks.h>
#endif
#include <specfun_testcase.h>

//  Divergence at a=0.25000000000000000 x=50.000000000000000 f1=inf f2=-4.6814734487901089e+61

// Test data for a=0.25000000000000000.
// max(|f - f_GSL|): 23656969470083144.
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000004
// mean(f - f_GSL): 4731393894033550.0
// variance(f - f_GSL): 1.1193044090149144e+32
// stddev(f - f_GSL): 10579718375339272.
const testcase_pochhammer_l<double>
data001[5] =
{
  { 0.25000000000000000, 0.25000000000000000, 1.0000000000000000 },
  { -0.18750000000000000, 0.25000000000000000, 2.0000000000000000 },
  { 3.3837890625000000, 0.25000000000000000, 5.0000000000000000 },
  { -42303.691363334656, 0.25000000000000000, 10.000000000000000 },
  { -11828484735041610., 0.25000000000000000, 20.000000000000000 },
};
const double toler001 = 0.050000000000000003;
//  Divergence at a=0.50000000000000000 x=50.000000000000000 f1=inf f2=-2.4450853371181271e+61

// Test data for a=0.50000000000000000.
// max(|f - f_GSL|): 15641774239803068.
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000000
// mean(f - f_GSL): 3128354847974074.5
// variance(f - f_GSL): 4.8933020273689057e+31
// stddev(f - f_GSL): 6995214097773495.0
const testcase_pochhammer_l<double>
data002[5] =
{
  { 0.50000000000000000, 0.50000000000000000, 1.0000000000000000 },
  { -0.25000000000000000, 0.50000000000000000, 2.0000000000000000 },
  { 3.2812499999999996, 0.50000000000000000, 5.0000000000000000 },
  { -33651.782226562500, 0.50000000000000000, 10.000000000000000 },
  { -7820887119901554.0, 0.50000000000000000, 20.000000000000000 },
};
const double toler002 = 0.050000000000000003;
//  Divergence at a=0.75000000000000000 x=50.000000000000000 f1=inf f2=-6.7811862645560589e+60

// Test data for a=0.75000000000000000.
// max(|f - f_GSL|): 5502847720919143.0
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000031
// mean(f - f_GSL): 1100569544189546.9
// variance(f - f_GSL): 6.0562666079092988e+30
// stddev(f - f_GSL): 2460948314757809.0
const testcase_pochhammer_l<double>
data003[5] =
{
  { 0.75000000000000000, 0.75000000000000000, 1.0000000000000000 },
  { -0.18750000000000000, 0.75000000000000000, 2.0000000000000000 },
  { 1.7138671875000000, 0.75000000000000000, 5.0000000000000000 },
  { -14295.434832572937, 0.75000000000000000, 10.000000000000000 },
  { -2751423860459567.5, 0.75000000000000000, 20.000000000000000 },
};
const double toler003 = 0.050000000000000003;
//  Divergence at a=1.0000000000000000 x=2.0000000000000000 f1=inf f2=0.0000000000000000

// Test data for a=1.0000000000000000.
// max(|f - f_GSL|): 0.0000000000000000
// max(|f - f_GSL| / |f_GSL|): 0.0000000000000000
// mean(f - f_GSL): 0.0000000000000000
// variance(f - f_GSL): 0.0000000000000000
// stddev(f - f_GSL): 0.0000000000000000
const testcase_pochhammer_l<double>
data004[1] =
{
  { 1.0000000000000000, 1.0000000000000000, 1.0000000000000000 },
};
const double toler004 = 2.5000000000000020e-13;
//  Divergence at a=1.2500000000000000 x=50.000000000000000 f1=inf f2=1.2003778073820791e+60

// Test data for a=1.2500000000000000.
// max(|f - f_GSL|): 2.2558593750000000
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000000
// mean(f - f_GSL): 0.47617187500018188
// variance(f - f_GSL): 3.2201524416892275
// stddev(f - f_GSL): 1.7944783202059666
const testcase_pochhammer_l<double>
data005[5] =
{
  { 1.2500000000000000, 1.2500000000000000, 1.0000000000000000 },
  { 0.31250000000000000, 1.2500000000000000, 2.0000000000000000 },
  { -1.1279296875000000, 1.2500000000000000, 5.0000000000000000 },
  { 6043.3844804763794, 1.2500000000000000, 10.000000000000000 },
  { 788565649002774.00, 1.2500000000000000, 20.000000000000000 },
};
const double toler005 = 0.050000000000000003;
//  Divergence at a=1.5000000000000000 x=50.000000000000000 f1=inf f2=7.5621195993344138e+59

// Test data for a=1.5000000000000000.
// max(|f - f_GSL|): 3.5000000000000000
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000000
// mean(f - f_GSL): 1.2624999999998181
// variance(f - f_GSL): 19.239739421339340
// stddev(f - f_GSL): 4.3863127363811323
const testcase_pochhammer_l<double>
data006[5] =
{
  { 1.5000000000000000, 1.5000000000000000, 1.0000000000000000 },
  { 0.75000000000000000, 1.5000000000000000, 2.0000000000000000 },
  { -1.4062500000000000, 1.5000000000000000, 5.0000000000000000 },
  { 5938.5498046875000, 1.5000000000000000, 10.000000000000000 },
  { 634125982694720.50, 1.5000000000000000, 20.000000000000000 },
};
const double toler006 = 0.050000000000000003;
//  Divergence at a=1.7500000000000000 x=50.000000000000000 f1=inf f2=2.4594976089063422e+59

// Test data for a=1.7500000000000000.
// max(|f - f_GSL|): 1.8457031250000000
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000000
// mean(f - f_GSL): 0.53789062500027285
// variance(f - f_GSL): 0.71219691921029293
// stddev(f - f_GSL): 0.84391760214507494
const testcase_pochhammer_l<double>
data007[5] =
{
  { 1.7500000000000000, 1.7500000000000000, 1.0000000000000000 },
  { 1.3125000000000000, 1.7500000000000000, 2.0000000000000000 },
  { -0.92285156250000000, 1.7500000000000000, 5.0000000000000000 },
  { 3032.3649644851685, 1.7500000000000000, 10.000000000000000 },
  { 263835164701602.38, 1.7500000000000000, 20.000000000000000 },
};
const double toler007 = 0.050000000000000003;
//  Divergence at a=2.0000000000000000 x=5.0000000000000000 f1=inf f2=0.0000000000000000

// Test data for a=2.0000000000000000.
// max(|f - f_GSL|): 0.0000000000000000
// max(|f - f_GSL| / |f_GSL|): 0.0000000000000000
// mean(f - f_GSL): 0.0000000000000000
// variance(f - f_GSL): 0.0000000000000000
// stddev(f - f_GSL): 0.0000000000000000
const testcase_pochhammer_l<double>
data008[2] =
{
  { 2.0000000000000000, 2.0000000000000000, 1.0000000000000000 },
  { 2.0000000000000000, 2.0000000000000000, 2.0000000000000000 },
};
const double toler008 = 2.5000000000000020e-13;
//  Divergence at a=2.2500000000000000 x=50.000000000000000 f1=inf f2=-5.6562305059888551e+58

// Test data for a=2.2500000000000000.
// max(|f - f_GSL|): 199918051859857.81
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000000
// mean(f - f_GSL): 39983610372673.375
// variance(f - f_GSL): 7.9934454918180136e+27
// stddev(f - f_GSL): 89406070777201.781
const testcase_pochhammer_l<double>
data009[5] =
{
  { 2.2500000000000000, 2.2500000000000000, 1.0000000000000000 },
  { 2.8125000000000000, 2.2500000000000000, 2.0000000000000000 },
  { 0.92285156250000000, 2.2500000000000000, 5.0000000000000000 },
  { -1754.5309782028198, 2.2500000000000000, 10.000000000000000 },
  { -99959025929929.078, 2.2500000000000000, 20.000000000000000 },
};
const double toler009 = 0.050000000000000003;
//  Divergence at a=2.5000000000000000 x=50.000000000000000 f1=inf f2=-3.9800629470181124e+58

// Test data for a=2.5000000000000000.
// max(|f - f_GSL|): 181178852198491.25
// max(|f - f_GSL| / |f_GSL|): 1.9999999999999987
// mean(f - f_GSL): 36235770440490.055
// variance(f - f_GSL): 6.5651552967208295e+27
// stddev(f - f_GSL): 81025645919800.172
const testcase_pochhammer_l<double>
data010[5] =
{
  { 2.5000000000000000, 2.5000000000000000, 1.0000000000000000 },
  { 3.7500000000000000, 2.5000000000000000, 2.0000000000000000 },
  { 1.4062500000000000, 2.5000000000000000, 5.0000000000000000 },
  { -1979.5166015625000, 2.5000000000000000, 10.000000000000000 },
  { -90589426099245.797, 2.5000000000000000, 20.000000000000000 },
};
const double toler010 = 0.050000000000000003;
//  Divergence at a=2.7500000000000000 x=50.000000000000000 f1=inf f2=-1.4314536348132149e+58

// Test data for a=2.7500000000000000.
// max(|f - f_GSL|): 84121356861380.484
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000004
// mean(f - f_GSL): 16824271372736.180
// variance(f - f_GSL): 1.4152805360205949e+27
// stddev(f - f_GSL): 37620214460055.844
const testcase_pochhammer_l<double>
data011[5] =
{
  { 2.7500000000000000, 2.7500000000000000, 1.0000000000000000 },
  { 4.8125000000000000, 2.7500000000000000, 2.0000000000000000 },
  { 1.1279296875000000, 2.7500000000000000, 5.0000000000000000 },
  { -1150.2074003219604, 2.7500000000000000, 10.000000000000000 },
  { -42060678430690.234, 2.7500000000000000, 20.000000000000000 },
};
const double toler011 = 0.050000000000000003;
//  Divergence at a=3.0000000000000000 x=5.0000000000000000 f1=inf f2=0.0000000000000000

// Test data for a=3.0000000000000000.
// max(|f - f_GSL|): 4.4408920985006262e-16
// max(|f - f_GSL| / |f_GSL|): 1.4802973661668753e-16
// mean(f - f_GSL): -2.2204460492503131e-16
// variance(f - f_GSL): 9.8607613152626476e-32
// stddev(f - f_GSL): 3.1401849173675503e-16
const testcase_pochhammer_l<double>
data012[2] =
{
  { 3.0000000000000000, 3.0000000000000000, 1.0000000000000000 },
  { 6.0000000000000000, 3.0000000000000000, 2.0000000000000000 },
};
const double toler012 = 2.5000000000000020e-13;
//  Divergence at a=3.2500000000000000 x=50.000000000000000 f1=inf f2=3.9321388544307538e+57

// Test data for a=3.2500000000000000.
// max(|f - f_GSL|): 3.4277343750000000
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000000
// mean(f - f_GSL): 0.70117187499986411
// variance(f - f_GSL): 83.631642996419615
// stddev(f - f_GSL): 9.1450337886975372
const testcase_pochhammer_l<double>
data013[5] =
{
  { 3.2500000000000000, 3.2500000000000000, 1.0000000000000000 },
  { 7.3125000000000000, 3.2500000000000000, 2.0000000000000000 },
  { -1.7138671875000000, 3.2500000000000000, 5.0000000000000000 },
  { 844.77417469024670, 3.2500000000000000, 10.000000000000000 },
  { 19395034881926.543, 3.2500000000000000, 20.000000000000000 },
};
const double toler013 = 0.050000000000000003;
//  Divergence at a=3.5000000000000000 x=50.000000000000000 f1=inf f2=2.9957463042071814e+57

// Test data for a=3.5000000000000000.
// max(|f - f_GSL|): 6.5625000000000000
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000000
// mean(f - f_GSL): 1.3070312500002277
// variance(f - f_GSL): 14404.411495091073
// stddev(f - f_GSL): 120.01837982197173
const testcase_pochhammer_l<double>
data014[5] =
{
  { 3.5000000000000000, 3.5000000000000000, 1.0000000000000000 },
  { 8.7500000000000000, 3.5000000000000000, 2.0000000000000000 },
  { -3.2812500000000000, 3.5000000000000000, 5.0000000000000000 },
  { 1065.8935546875000, 3.5000000000000000, 10.000000000000000 },
  { 19215938869536.988, 3.5000000000000000, 20.000000000000000 },
};
const double toler014 = 0.050000000000000003;
//  Divergence at a=3.7500000000000000 x=50.000000000000000 f1=inf f2=1.1606380822809851e+57

// Test data for a=3.7500000000000000.
// max(|f - f_GSL|): 6.7675781250000018
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000004
// mean(f - f_GSL): 1.3574218750000238
// variance(f - f_GSL): 18405.854452056778
// stddev(f - f_GSL): 135.66817774281770
const testcase_pochhammer_l<double>
data015[5] =
{
  { 3.7500000000000000, 3.7500000000000000, 1.0000000000000000 },
  { 10.312500000000000, 3.7500000000000000, 2.0000000000000000 },
  { -3.3837890625000000, 3.7500000000000000, 5.0000000000000000 },
  { 690.12444019317627, 3.7500000000000000, 10.000000000000000 },
  { 9706310407082.3613, 3.7500000000000000, 20.000000000000000 },
};
const double toler015 = 0.050000000000000003;
//  Divergence at a=4.0000000000000000 x=5.0000000000000000 f1=inf f2=0.0000000000000000

// Test data for a=4.0000000000000000.
// max(|f - f_GSL|): 8.8817841970012523e-16
// max(|f - f_GSL| / |f_GSL|): 2.2204460492503131e-16
// mean(f - f_GSL): 4.4408920985006262e-16
// variance(f - f_GSL): 3.9443045261050590e-31
// stddev(f - f_GSL): 6.2803698347351007e-16
const testcase_pochhammer_l<double>
data016[2] =
{
  { 4.0000000000000000, 4.0000000000000000, 1.0000000000000000 },
  { 12.000000000000000, 4.0000000000000000, 2.0000000000000000 },
};
const double toler016 = 2.5000000000000020e-13;
//  Divergence at a=4.2500000000000000 x=50.000000000000000 f1=inf f2=-3.6528065860832145e+56

// Test data for a=4.2500000000000000.
// max(|f - f_GSL|): 10467161682309.574
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000027
// mean(f - f_GSL): 2093432336711.6741
// variance(f - f_GSL): 2.1912294735414938e+25
// stddev(f - f_GSL): 4681057010485.4453
const testcase_pochhammer_l<double>
data017[5] =
{
  { 4.2500000000000000, 4.2500000000000000, 1.0000000000000000 },
  { 13.812500000000000, 4.2500000000000000, 2.0000000000000000 },
  { 9.7119140625000000, 4.2500000000000000, 5.0000000000000000 },
  { -624.39830303192139, 4.2500000000000000, 10.000000000000000 },
  { -5233580841154.7803, 4.2500000000000000, 20.000000000000000 },
};
const double toler017 = 0.050000000000000003;
//  Divergence at a=4.5000000000000000 x=50.000000000000000 f1=inf f2=-2.9628260151499600e+56

// Test data for a=4.5000000000000000.
// max(|f - f_GSL|): 11157641924247.293
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000018
// mean(f - f_GSL): 2231528385198.2964
// variance(f - f_GSL): 2.4898594659998496e+25
// stddev(f - f_GSL): 4989849162048.7383
const testcase_pochhammer_l<double>
data018[5] =
{
  { 4.5000000000000000, 4.5000000000000000, 1.0000000000000000 },
  { 15.750000000000000, 4.5000000000000000, 2.0000000000000000 },
  { 29.531250000000000, 4.5000000000000000, 5.0000000000000000 },
  { -872.09472656249989, 4.5000000000000000, 10.000000000000000 },
  { -5578820962123.6416, 4.5000000000000000, 20.000000000000000 },
};
const double toler018 = 0.050000000000000003;
//  Divergence at a=4.7500000000000000 x=50.000000000000000 f1=inf f2=-1.2183493681402606e+56

// Test data for a=4.7500000000000000.
// max(|f - f_GSL|): 6046554024084.0957
// max(|f - f_GSL| / |f_GSL|): 2.0000000000000004
// mean(f - f_GSL): 1209310805066.5784
// variance(f - f_GSL): 7.3121631124785371e+24
// stddev(f - f_GSL): 2704101165355.7891
const testcase_pochhammer_l<double>
data019[5] =
{
  { 4.7500000000000000, 4.7500000000000000, 1.0000000000000000 },
  { 17.812500000000000, 4.7500000000000000, 2.0000000000000000 },
  { 64.291992187500000, 4.7500000000000000, 5.0000000000000000 },
  { -624.39830303192139, 4.7500000000000000, 10.000000000000000 },
  { -3023277012042.0469, 4.7500000000000000, 20.000000000000000 },
};
const double toler019 = 0.050000000000000003;
//  Divergence at a=5.0000000000000000 x=10.000000000000000 f1=inf f2=0.0000000000000000

// Test data for a=5.0000000000000000.
// max(|f - f_GSL|): 2.8421709430404007e-14
// max(|f - f_GSL| / |f_GSL|): 3.5527136788005011e-16
// mean(f - f_GSL): -1.1250259982868252e-14
// variance(f - f_GSL): 2.2114400709695696e-28
// stddev(f - f_GSL): 1.4870911441366229e-14
const testcase_pochhammer_l<double>
data020[3] =
{
  { 5.0000000000000000, 5.0000000000000000, 1.0000000000000000 },
  { 20.000000000000000, 5.0000000000000000, 2.0000000000000000 },
  { 120.00000000000000, 5.0000000000000000, 5.0000000000000000 },
};
const double toler020 = 2.5000000000000020e-13;

template<typename Tp, unsigned int Num>
  void
  test(const testcase_pochhammer_l<Tp> (&data)[Num], Tp toler)
  {
    typedef Tp Val;
    bool test __attribute__((unused)) = true;
    const Val eps = std::numeric_limits<Val>::epsilon();
    Val max_abs_diff = -Val(1);
    Val max_abs_frac = -Val(1);
    unsigned int num_datum = Num;
    for (unsigned int i = 0; i < num_datum; ++i)
      {
	const Tp f = __gnu_cxx::pochhammer_l(data[i].a, data[i].x);
	const Tp f0 = data[i].f0;
	const Tp diff = f - f0;
	if (std::abs(diff) > max_abs_diff)
	  max_abs_diff = std::abs(diff);
	if (std::abs(f0) > Val(10) * eps
	 && std::abs(f) > Val(10) * eps)
	  {
	    const Tp frac = diff / f0;
	    if (std::abs(frac) > max_abs_frac)
	      max_abs_frac = std::abs(frac);
	  }
      }
    VERIFY(max_abs_frac < toler);
  }

int
main()
{
  test(data001, toler001);
  test(data002, toler002);
  test(data003, toler003);
  test(data004, toler004);
  test(data005, toler005);
  test(data006, toler006);
  test(data007, toler007);
  test(data008, toler008);
  test(data009, toler009);
  test(data010, toler010);
  test(data011, toler011);
  test(data012, toler012);
  test(data013, toler013);
  test(data014, toler014);
  test(data015, toler015);
  test(data016, toler016);
  test(data017, toler017);
  test(data018, toler018);
  test(data019, toler019);
  test(data020, toler020);
  return 0;
}
